<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upatha AI - Birth Chart Analysis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="importmap">
        {
            "imports": {
                "@google/generative-ai": "https://esm.run/@google/generative-ai"
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Sinhala:wght@300;400;600;700&family=Playfair+Display:wght@400;600;700&display=swap');
        
        body {
            font-family: 'Playfair Display', serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
        }
        
        .sinhala-font {
            font-family: 'Noto Sans Sinhala', sans-serif;
        }
        
        .golden-border {
            border: 2px solid #d4af37;
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
        }
        
        .royal-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(212, 175, 55, 0.3);
        }
        
        .loading-spinner {
            border: 4px solid rgba(212, 175, 55, 0.3);
            border-top: 4px solid #d4af37;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .chart-house {
            stroke: #d4af37;
            stroke-width: 2;
            fill: rgba(26, 26, 46, 0.8);
        }
        
        .chart-text {
            fill: #d4af37;
            font-family: 'Noto Sans Sinhala', sans-serif;
            font-size: 12px;
            text-anchor: middle;
        }
        
        .btn-golden {
            background: linear-gradient(135deg, #d4af37 0%, #f4e5a1 50%, #d4af37 100%);
            color: #1a1a2e;
            font-weight: 700;
            transition: all 0.3s ease;
        }
        
        .btn-golden:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.5);
        }
        
        input, select {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(212, 175, 55, 0.3);
            color: #ffffff;
            backdrop-filter: blur(10px);
        }
        
        input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #d4af37;
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.3);
        }
        
        .toggle-checkbox:checked {
            background-color: #d4af37;
            border-color: #d4af37;
        }
        
        .result-section {
            animation: fadeIn 0.6s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="text-white">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <header class="text-center mb-12">
            <h1 class="text-5xl font-bold mb-4 text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 via-yellow-200 to-yellow-400" id="mainTitle">
                Upatha AI
            </h1>
            <p class="text-xl text-yellow-200 opacity-80" id="subtitle">
                Your Journey Through Time and Stars
            </p>
        </header>

        <!-- Input Form -->
        <div class="royal-card rounded-2xl p-8 mb-8 golden-border">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Gender -->
                <div>
                    <label class="block text-yellow-200 mb-2 font-semibold" id="genderLabel">Gender</label>
                    <select id="gender" class="w-full px-4 py-3 rounded-lg">
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <!-- Birth Date -->
                <div>
                    <label class="block text-yellow-200 mb-2 font-semibold" id="dateLabel">Birth Date</label>
                    <input type="date" id="birthDate" class="w-full px-4 py-3 rounded-lg">
                </div>

                <!-- Birth Time -->
                <div>
                    <label class="block text-yellow-200 mb-2 font-semibold" id="timeLabel">Birth Time</label>
                    <input type="time" id="birthTime" class="w-full px-4 py-3 rounded-lg">
                </div>

                <!-- Language Toggle -->
                <div>
                    <label class="block text-yellow-200 mb-2 font-semibold" id="languageLabel">Language</label>
                    <div class="flex items-center space-x-4 mt-3">
                        <span class="text-white" id="englishText">English</span>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="languageToggle" class="sr-only peer">
                            <div class="w-14 h-7 bg-gray-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-yellow-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-yellow-500"></div>
                        </label>
                        <span class="text-white sinhala-font" id="sinhalaText">සිංහල</span>
                    </div>
                </div>
            </div>

            <!-- Generate Button -->
            <div class="mt-8 text-center">
                <button id="generateBtn" class="btn-golden px-12 py-4 rounded-full text-lg font-bold shadow-xl">
                    Generate Analysis
                </button>
            </div>
        </div>

        <!-- Loading Animation -->
        <div id="loadingSection" class="hidden text-center py-12">
            <div class="loading-spinner mx-auto mb-4"></div>
            <p class="text-2xl text-yellow-200 font-semibold" id="loadingText">Calculating...</p>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="hidden">
            <!-- Birth Chart -->
            <div class="royal-card rounded-2xl p-8 mb-8 golden-border result-section">
                <h2 class="text-3xl font-bold text-yellow-200 mb-6 text-center" id="chartTitle">Hathara Kendraya</h2>
                <div class="flex justify-center">
                    <svg id="chartSVG" width="500" height="500" viewBox="0 0 500 500" class="max-w-full h-auto">
                        <!-- Chart will be drawn here -->
                    </svg>
                </div>
            </div>

            <!-- Life Document -->
            <div class="royal-card rounded-2xl p-8 golden-border result-section">
                <h2 class="text-3xl font-bold text-yellow-200 mb-6 text-center" id="documentTitle">Life Document</h2>
                
                <!-- Personality Analysis -->
                <div class="mb-8">
                    <h3 class="text-2xl font-semibold text-yellow-300 mb-4" id="personalityTitle">Personality Analysis</h3>
                    <div class="bg-black bg-opacity-30 rounded-lg p-6">
                        <p class="text-lg leading-relaxed" id="personalityContent">Loading...</p>
                    </div>
                </div>

                <!-- Historical Events -->
                <div class="mb-8">
                    <h3 class="text-2xl font-semibold text-yellow-300 mb-4" id="eventsTitle">Historical Events on Your Birth Date</h3>
                    <div class="bg-black bg-opacity-30 rounded-lg p-6">
                        <p class="text-lg leading-relaxed" id="eventsContent">Loading...</p>
                    </div>
                </div>

                <!-- Generational Traits -->
                <div>
                    <h3 class="text-2xl font-semibold text-yellow-300 mb-4" id="generationTitle">Generational Traits</h3>
                    <div class="bg-black bg-opacity-30 rounded-lg p-6">
                        <p class="text-lg leading-relaxed" id="generationContent">Loading...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { GoogleGenerativeAI } from "@google/generative-ai";
        
        // Initialize Gemini API
        const API_KEY = 'AIzaSyBLdn4EsHcp6etwtfTpERV6WSTQOYN-HOU';
        const genAI = new GoogleGenerativeAI(API_KEY);
        const model = genAI.getGenerativeModel({ model: "gemini-pro" });
        
        // Translations
        const translations = {
            en: {
                mainTitle: 'Upatha AI',
                subtitle: 'Your Journey Through Time and Stars',
                genderLabel: 'Gender',
                dateLabel: 'Birth Date',
                timeLabel: 'Birth Time',
                languageLabel: 'Language',
                englishText: 'English',
                sinhalaText: 'සිංහල',
                generateBtn: 'Generate Analysis',
                loadingText: 'Calculating...',
                chartTitle: 'Hathara Kendraya',
                documentTitle: 'Life Document',
                personalityTitle: 'Personality Analysis',
                eventsTitle: 'Historical Events on Your Birth Date',
                generationTitle: 'Generational Traits',
                male: 'Male',
                female: 'Female',
                other: 'Other',
                planets: ['Sun', 'Moon', 'Mars', 'Mercury', 'Jupiter', 'Venus', 'Saturn', 'Rahu', 'Ketu', 'Ascendant', 'Midheaven', 'Neptune']
            },
            si: {
                mainTitle: 'උපත AI',
                subtitle: 'කාලය සහ තාරකා හරහා ඔබේ ගමන',
                genderLabel: 'ස්ත්‍රී පුරුෂ භාවය',
                dateLabel: 'උපන් දිනය',
                timeLabel: 'උපන් වේලාව',
                languageLabel: 'භාෂාව',
                englishText: 'English',
                sinhalaText: 'සිංහල',
                generateBtn: 'විශ්ලේෂණය ජනනය කරන්න',
                loadingText: 'ගණනය කරමින් පවතී...',
                chartTitle: 'හතර කේන්ද්‍රය',
                documentTitle: 'ජීවිත ලේඛනය',
                personalityTitle: 'පෞරුෂ විශ්ලේෂණය',
                eventsTitle: 'ඔබේ උපන් දිනයේ ඓතිහාසික සිදුවීම්',
                generationTitle: 'පරම්පරාගත ලක්ෂණ',
                male: 'පුරුෂ',
                female: 'ස්ත්‍රී',
                other: 'වෙනත්',
                planets: ['සූර්යයා', 'චන්ද්‍රයා', 'අඟහරු', 'බුධ', 'ගුරු', 'සිකුරු', 'සෙනසුරු', 'රාහු', 'කේතු', 'ලග්නය', 'මධ්‍යස්ථ', 'නෙප්චූන්']
            }
        };

        let currentLang = 'en';

        // Language toggle handler
        document.getElementById('languageToggle').addEventListener('change', function() {
            currentLang = this.checked ? 'si' : 'en';
            updateLanguage();
        });

        function updateLanguage() {
            const lang = translations[currentLang];
            
            // Update text content
            document.getElementById('mainTitle').textContent = lang.mainTitle;
            document.getElementById('subtitle').textContent = lang.subtitle;
            document.getElementById('genderLabel').textContent = lang.genderLabel;
            document.getElementById('dateLabel').textContent = lang.dateLabel;
            document.getElementById('timeLabel').textContent = lang.timeLabel;
            document.getElementById('languageLabel').textContent = lang.languageLabel;
            document.getElementById('generateBtn').textContent = lang.generateBtn;
            document.getElementById('loadingText').textContent = lang.loadingText;
            document.getElementById('chartTitle').textContent = lang.chartTitle;
            document.getElementById('documentTitle').textContent = lang.documentTitle;
            document.getElementById('personalityTitle').textContent = lang.personalityTitle;
            document.getElementById('eventsTitle').textContent = lang.eventsTitle;
            document.getElementById('generationTitle').textContent = lang.generationTitle;
            
            // Update dropdown options
            const genderSelect = document.getElementById('gender');
            genderSelect.options[0].text = lang.male;
            genderSelect.options[1].text = lang.female;
            genderSelect.options[2].text = lang.other;

            // Apply Sinhala font to body if Sinhala is selected
            if (currentLang === 'si') {
                document.body.classList.add('sinhala-font');
            } else {
                document.body.classList.remove('sinhala-font');
            }
        }

        // Draw Hathara Kendraya (12-house birth chart)
        function drawKendraya(positions) {
            const svg = document.getElementById('chartSVG');
            svg.innerHTML = ''; // Clear previous chart
            
            const width = 500;
            const height = 500;
            const centerX = width / 2;
            const centerY = height / 2;
            const size = 400;
            
            // Create the main square
            const mainSquare = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            mainSquare.setAttribute('x', (width - size) / 2);
            mainSquare.setAttribute('y', (height - size) / 2);
            mainSquare.setAttribute('width', size);
            mainSquare.setAttribute('height', size);
            mainSquare.setAttribute('class', 'chart-house');
            svg.appendChild(mainSquare);
            
            // Draw diagonal lines to create the diamond pattern
            const diagonals = [
                { x1: 50, y1: 50, x2: 250, y2: 250 },
                { x1: 450, y1: 50, x2: 250, y2: 250 },
                { x1: 50, y1: 450, x2: 250, y2: 250 },
                { x1: 450, y1: 450, x2: 250, y2: 250 }
            ];
            
            diagonals.forEach(line => {
                const lineEl = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                lineEl.setAttribute('x1', line.x1);
                lineEl.setAttribute('y1', line.y1);
                lineEl.setAttribute('x2', line.x2);
                lineEl.setAttribute('y2', line.y2);
                lineEl.setAttribute('stroke', '#d4af37');
                lineEl.setAttribute('stroke-width', '2');
                svg.appendChild(lineEl);
            });
            
            // Draw middle cross
            const horizontalLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            horizontalLine.setAttribute('x1', 50);
            horizontalLine.setAttribute('y1', 250);
            horizontalLine.setAttribute('x2', 450);
            horizontalLine.setAttribute('y2', 250);
            horizontalLine.setAttribute('stroke', '#d4af37');
            horizontalLine.setAttribute('stroke-width', '2');
            svg.appendChild(horizontalLine);
            
            const verticalLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            verticalLine.setAttribute('x1', 250);
            verticalLine.setAttribute('y1', 50);
            verticalLine.setAttribute('x2', 250);
            verticalLine.setAttribute('y2', 450);
            verticalLine.setAttribute('stroke', '#d4af37');
            verticalLine.setAttribute('stroke-width', '2');
            svg.appendChild(verticalLine);
            
            // Define house positions (12 houses in traditional square chart)
            const housePositions = [
                { x: 150, y: 100 },  // House 1 (Top Left inner)
                { x: 250, y: 100 },  // House 2 (Top Center)
                { x: 350, y: 100 },  // House 3 (Top Right inner)
                { x: 400, y: 150 },  // House 4 (Right Top)
                { x: 400, y: 250 },  // House 5 (Right Center)
                { x: 400, y: 350 },  // House 6 (Right Bottom)
                { x: 350, y: 400 },  // House 7 (Bottom Right inner)
                { x: 250, y: 400 },  // House 8 (Bottom Center)
                { x: 150, y: 400 },  // House 9 (Bottom Left inner)
                { x: 100, y: 350 },  // House 10 (Left Bottom)
                { x: 100, y: 250 },  // House 11 (Left Center)
                { x: 100, y: 150 }   // House 12 (Left Top)
            ];
            
            // Add house numbers and planets
            housePositions.forEach((pos, index) => {
                const houseNum = index + 1;
                
                // House number
                const houseText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                houseText.setAttribute('x', pos.x);
                houseText.setAttribute('y', pos.y - 10);
                houseText.setAttribute('class', 'chart-text');
                houseText.setAttribute('font-size', '10');
                houseText.setAttribute('opacity', '0.7');
                houseText.textContent = houseNum;
                svg.appendChild(houseText);
                
                // Planet name
                if (positions[houseNum]) {
                    const planetText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    planetText.setAttribute('x', pos.x);
                    planetText.setAttribute('y', pos.y + 10);
                    planetText.setAttribute('class', 'chart-text');
                    planetText.setAttribute('font-weight', 'bold');
                    planetText.textContent = positions[houseNum];
                    svg.appendChild(planetText);
                }
            });
        }

        // Generate random planet positions for demonstration
        function generatePlanetPositions() {
            const positions = {};
            const planets = translations[currentLang].planets;
            const usedHouses = new Set();
            
            // Place random planets in random houses (not all planets need to be placed)
            const numPlanets = Math.floor(Math.random() * 5) + 8; // 8-12 planets
            
            for (let i = 0; i < numPlanets && i < planets.length; i++) {
                let house;
                do {
                    house = Math.floor(Math.random() * 12) + 1;
                } while (usedHouses.has(house));
                
                usedHouses.add(house);
                positions[house] = planets[i];
            }
            
            return positions;
        }

        // Generate AI prompt
        function generatePrompt(gender, birthDate, birthTime, language) {
            if (language === 'si') {
                return `කරුණාකර මෙම තොරතුරු මත පදනම්ව සවිස්තරාත්මක ජීවිත විශ්ලේෂණයක් සපයන්න:
                ස්ත්‍රී පුරුෂ භාවය: ${gender}
                උපන් දිනය: ${birthDate}
                උපන් වේලාව: ${birthTime}
                
                කරුණාකර මේවා ඇතුළත් කරන්න:
                1. උපන් වේලාව මත පදනම්ව පෞරුෂ විශ්ලේෂණයක්
                2. ඔබේ උපන් දිනයේ සිදු වූ ප්‍රධාන ඓතිහාසික සිදුවීම්
                3. ඔබේ පරම්පරාවේ සුවිශේෂී ලක්ෂණ`;
            } else {
                return `Please provide a detailed life analysis based on this information:
                Gender: ${gender}
                Birth Date: ${birthDate}
                Birth Time: ${birthTime}
                
           Call Gemini AI API
        async function callAI(prompt) {
            try {
                const result = await model.generateContent(prompt);
                const response = await result.response;
                const text = response.text();
                
                // Parse the response to extract sections
                // The AI should return text with clear sections
                const sections = {
                    personality: '',
                    events: '',
                    generation: ''
                };
                
                // Try to intelligently parse the response
                if (currentLang === 'si') {
                    // Split by common Sinhala section markers
                    const parts = text.split(/(?:පෞරුෂ විශ්ලේෂණය|ඓතිහාසික සිදුවීම්|පරම්පරාගත ලක්ෂණ)/i);
                    if (parts.length >= 4) {
                        sections.personality = parts[1].trim();
                        sections.events = parts[2].trim();
                        sections.generation = parts[3].trim();
                    } else {
                        // If parsing fails, split into roughly equal parts
                        const words = text.split('\n').filter(line => line.trim());
                        const third = Math.ceil(words.length / 3);
                        sections.personality = words.slice(0, third).join('\n');
                        sections.events = words.slice(third, third * 2).join('\n');
                        sections.generation = words.slice(third * 2).join('\n');
                    }
                } else {
                    // Split by common English section markers
                    const parts = text.split(/(?:Personality Analysis|Historical Events|Generational Traits)/i);
                    if (parts.length >= 4) {
                        sections.personality = parts[1].trim();
                        sections.events = parts[2].trim();
                        sections.generation = parts[3].trim();
                    } else {
                        // If parsing fails, split into roughly equal parts
                        const words = text.split('\n').filter(line => line.trim());
                        const third = Math.ceil(words.length / 3);
                        sections.personality = words.slice(0, third).join('\n');
                        sections.events = words.slice(third, third * 2).join('\n');
                        sections.generation = words.slice(third * 2).join('\n');
                    }
                }
                
                // Clean up the sections
                sections.personality = sections.personality.replace(/^[:：\-\s]+/, '').trim();
                sections.events = sections.events.replace(/^[:：\-\s]+/, '').trim();
                sections.generation = sections.generation.replace(/^[:：\-\s]+/, '').trim();
                
                return sections;
            } catch (error) {
                console.error('Gemini API Error:', error);
                // Fallback to sample data if API fails
                if (currentLang === 'si') {
                    return {
                        personality: `ඔබ අතිශය නිර්මාණශීලී සහ සංවේදී පුද්ගලයෙකි. ඔබේ උපන් වේලාව පෙන්නුම් කරන්නේ ඔබට ශක්තිමත් අන්තර් දර්ශනයක් සහ අන් අයගේ හැඟීම් ගැඹුරින් අවබෝධ කර ගැනීමේ හැකියාවක් ඇති බවයි.`,
                        events: `ඔබේ උපන් දිනයේ ලෝකය බොහෝ වැදගත් සිදුවීම් දුටුවේය. මෙම දිනය ඉතිහාසයේ වැදගත් කොටසක් වන අතර ඔබේ ජීවිතයට විශේෂ තේරුමක් එක් කරයි.`,
                        generation: `ඔබේ පරම්පරාව තාක්ෂණික විප්ලවයක් මධ්‍යයේ වර්ධනය වූ අයෙකි. ඔබ ඩිජිටල් යුගයේ පුරෝගාමීන්ගෙන් කෙනෙකු වන අතර සම්ප්‍රදායික සහ නවීන අගයන් අතර සමතුලිතතාවයක් පවත්වා ගෙන යයි.`
                    };
                } else {
                    return {
                        personality: `You are a highly creative and sensitive individual. Your birth time indicates that you possess strong intuition and the ability to deeply understand the feelings of others.`,
                        events: `On your birth date, the world witnessed several significant events. This day marks an important piece of history and adds special meaning to your life.`,
                        generation: `Your generation grew up during a technological revolution. You are among the pioneers of the digital age, maintaining a balance between traditional and modern values.`
                    };
                }
            }         resolve({
                            personality: `You are a highly creative and sensitive individual. Your birth time indicates that you possess strong intuition and the ability to deeply understand the feelings of others. You naturally exhibit leadership qualities and have the strength to overcome challenges. Your thinking is profound, and you are someone who seeks truth and wisdom.`,
                            events: `On your birth date, the world witnessed several significant events. This day marks an important piece of history and adds special meaning to your life. On this date, important technological, cultural, or political changes may have occurred that shaped the era you were born into.`,
                            generation: `Your generation grew up during a technological revolution. You are among the pioneers of the digital age, maintaining a balance between traditional and modern values. Your generation shows a strong commitment to social change and environmental consciousness.`
                        });
                    }
                }, 2000); // Simulate API delay
            });
        }

        // Main generate function
        document.getElementById('generateBtn').addEventListener('click', async function() {
            const gender = document.getElementById('gender').value;
            const birthDate = document.getElementById('birthDate').value;
            const birthTime = document.getElementById('birthTime').value;
            
            if (!birthDate || !birthTime) {
                alert(currentLang === 'si' ? 'කරුණාකර සියලු ක්ෂේත්‍ර පුරවන්න' : 'Please fill all fields');
                return;
            }
            
            // Show loading
            document.getElementById('loadingSection').classList.remove('hidden');
            document.getElementById('resultsSection').classList.add('hidden');
            
            try {
                // Generate AI prompt
                const prompt = generatePrompt(gender, birthDate, birthTime, currentLang);
                
                // Call AI (placeholder)
                const results = await callAI(prompt);
                
                // Generate planet positions
                const positions = generatePlanetPositions();
                
                // Draw chart
                drawKendraya(positions);
                
                // Update results
                document.getElementById('personalityContent').textContent = results.personality;
                document.getElementById('eventsContent').textContent = results.events;
                document.getElementById('generationContent').textContent = results.generation;
                
                // Hide loading, show results
                document.getElementById('loadingSection').classList.add('hidden');
                document.getElementById('resultsSection').classList.remove('hidden');
                
                // Smooth scroll to results
                document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
                
            } catch (error) {
                console.error('Error:', error);
                alert(currentLang === 'si' ? 'දෝෂයක් ඇති විය. කරුණාකර නැවත උත්සාහ කරන්න.' : 'An error occurred. Please try again.');
                document.getElementById('loadingSection').classList.add('hidden');
            }
        });

        // Initialize with current date and time
        const now = new Date();
        document.getElementById('birthDate').valueAsDate = now;
        document.getElementById('birthTime').value = now.toTimeString().slice(0, 5);
    </script>
</body>
</html>